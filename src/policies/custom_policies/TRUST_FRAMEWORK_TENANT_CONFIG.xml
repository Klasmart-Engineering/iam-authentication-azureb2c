<TrustFrameworkPolicy xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns="http://schemas.microsoft.com/online/cpim/schemas/2013/06" PolicySchemaVersion="0.3.0.0" TenantId="{settings:Tenant}" PolicyId="B2C_1A__{settings:PolicyNamePrefix}TrustFrameworkTenantConfig" PublicPolicyUri="http://{settings:Tenant}/B2C_1A__{settings:PolicyNamePrefix}TrustFrameworkTenantConfig" TenantObjectId="8dc632b7-4df1-4904-a155-7c4663e345bb">
  <BasePolicy>
    <TenantId>{settings:Tenant}</TenantId>
    <PolicyId>B2C_1A__{settings:PolicyNamePrefix}TrustFrameworkExtensions</PolicyId>
  </BasePolicy>
  <ClaimsProviders>
    <ClaimsProvider>
      <DisplayName>Local Account SignIn</DisplayName>
      <TechnicalProfiles>
        <TechnicalProfile Id="login-NonInteractive">
          <Metadata>
            <!-- ProxyIdentityExperienceFramework: Application ID -->
            <Item Key="client_id">{settings:ProxyIdentityExperienceFrameworkAppId}</Item>
            <!-- IdentityExperienceFramework: Application ID-->
            <Item Key="IdTokenAudience">{settings:IdentityExperienceFrameworkAppId}</Item>
          </Metadata>
          <InputClaims>
            <!-- ProxyIdentityExperienceFramework: Application ID -->
            <InputClaim ClaimTypeReferenceId="client_id" DefaultValue="{settings:ProxyIdentityExperienceFrameworkAppId}" />
            <!-- IdentityExperienceFramework: Application ID-->
            <InputClaim ClaimTypeReferenceId="resource_id" PartnerClaimType="resource" DefaultValue="{settings:IdentityExperienceFrameworkAppId}" />
          </InputClaims>
        </TechnicalProfile>
      </TechnicalProfiles>
    </ClaimsProvider>
    <ClaimsProvider>
      <DisplayName>Azure Active Directory</DisplayName>
      <TechnicalProfiles>
        <TechnicalProfile Id="AAD-Common">
          <DisplayName>Azure Active Directory</DisplayName>
          <!-- Provide objectId and appId before using extension properties. -->
          <Metadata>
            <!-- B2C Extensions app: Object ID-->
            <Item Key="ApplicationObjectId">{settings:B2CExtensionsAppObjectId}</Item>
            <!-- B2C Extensions app: Application ID-->
            <Item Key="ClientId">{settings:B2CExtensionsAppAppId}</Item>
          </Metadata>
        </TechnicalProfile>
      </TechnicalProfiles>
    </ClaimsProvider>
    <ClaimsProvider>
      <DisplayName>Application Insights</DisplayName>
      <TechnicalProfiles>
        <TechnicalProfile Id="AzureInsights-Common">
          <DisplayName>Application Insights</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.Insights.AzureApplicationInsightsProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
          <Metadata>
            <!-- The ApplicationInsights instrumentation key which will be used for logging the events -->
            <Item Key="InstrumentationKey">{settings:AppInsightsInstrumentationKey}</Item>
            <!-- A Boolean that indicates whether developer mode is enabled. This controls how events are buffered. In a development environment with minimal event volume, enabling developer mode results in events being sent immediately to ApplicationInsights. -->
            <Item Key="DeveloperMode">{settings:AppInsightsDeveloperMode}</Item>
            <!-- A Boolean that indicates whether telemetry should be enabled or not. -->
            <Item Key="DisableTelemetry ">{settings:AppInsightsDisableTelemetry}</Item>
          </Metadata>
          <InputClaims>
            <!-- Properties of an event are added through the syntax {property:NAME}, where NAME is property being added to the event. DefaultValue can be either a static value or a value that's resolved by one of the supported DefaultClaimResolvers. -->
            <InputClaim ClaimTypeReferenceId="TenantId" PartnerClaimType="{property:TenantId}" DefaultValue="{Policy:RelyingPartyTenantId}" />
            <InputClaim ClaimTypeReferenceId="PolicyId" PartnerClaimType="{property:Policy}" DefaultValue="{Policy:PolicyId}" />
            <InputClaim ClaimTypeReferenceId="IP-Address" PartnerClaimType="{property:client_IP}" />
            <InputClaim ClaimTypeReferenceId="CorrelationId" PartnerClaimType="{property:CorrelationId}" />
            <InputClaim ClaimTypeReferenceId="Culture" PartnerClaimType="{property:Culture}" DefaultValue="{Culture:RFC5646}" />
            <InputClaim ClaimTypeReferenceId="objectId" PartnerClaimType="{property:ObjectId}" DefaultValue="Not available" />
          </InputClaims>
        </TechnicalProfile>
      </TechnicalProfiles>
    </ClaimsProvider>
    <ClaimsProvider>
      <DisplayName>Log in using KidsLoop</DisplayName>
      <TechnicalProfiles>
        <TechnicalProfile Id="Log-in-with-Kids-Loop">
          <Metadata>
            <Item Key="METADATA">https://login.microsoftonline.com/14a875d0-5038-4b90-8851-adf5acbeb8ea/v2.0/.well-known/openid-configuration</Item>
            <Item Key="client_id">0317151a-fbf6-4dd2-9354-97b73c1c9af8</Item>
          </Metadata>
          <CryptographicKeys>
            <Key Id="client_secret" StorageReferenceId="B2C_1A_KidsloopAppSecret" />
          </CryptographicKeys>
        </TechnicalProfile>
      </TechnicalProfiles>
    </ClaimsProvider>
  </ClaimsProviders>
</TrustFrameworkPolicy>
